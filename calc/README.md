# Распределенный вычислитель арифметических выражений

Проект представляет собой распределенную систему для вычисления арифметических выражений, написанную на языке Golang. Система использует архитектурный паттерн "Агент - Оркестратор", где Оркестратор принимает запросы на вычисление выражений, разбивает их на подзадачи и распределяет между Агентами для выполнения.

## Содержание
- [Описание архитектуры](#описание-архитектуры)
  - [Оркестратор](#оркестратор)
  - [Агент](#агент)
- [Интерфейс для работы с API](#интерфейс-для-работы-с-api)
- [API Оркестратора](#api-оркестратора)
  - [Добавление вычисления арифметического выражения](#1-добавление-вычисления-арифметического-выражения)
  - [Получение списка выражений](#2-получение-списка-выражений)
  - [Получение выражения по его идентификатору](#3-получение-выражения-по-его-идентификатору)
  - [Получение задачи для выполнения](#4-получение-задачи-для-выполнения)
  - [Прием результата обработки данных](#5-прием-результата-обработки-данных)
- [Настройка переменных окружения](#настройка-переменных-окружения)
- [Запуск проекта](#запуск-проекта)
- [Пример использования](#пример-использования)
- [Лицензия](#лицензия)

---

## Описание архитектуры

![pattern](https://github.com/KlimenkoKayot/calc-net-go/blob/main/web/static/img/pattern.jpg)

### Оркестратор
Оркестратор является центральным компонентом системы, который:
1. Принимает арифметические выражения от пользователей.
2. Разбивает выражения на подзадачи.
3. Распределяет задачи между Агентами.
4. Собирает результаты вычислений и возвращает их пользователям.

### Агент
Агент — это отдельная машина (или процесс), которая:
1. Постоянно запрашивает у Оркестратора новые задачи.
2. Выполняет полученные задачи (вычисляет арифметические операции).
3. Возвращает результаты вычислений Оркестратору.

---

## Интерфейс для работы с API
**Endpoint:** `/`
Интерфейс доступен по endpoint`у выше, например:
```
http://127.0.0.1:8080/
```
Реализован ввод выражений и обработка статуса с результатом.

--- 

## API Оркестратора

### 1. Добавление вычисления арифметического выражения
**Endpoint:** `POST /api/v1/calculate`

**Запрос:**
```json 
{
  "expression": "<строка с выражением>"
}
```

**Ответ:**
- Код ответа: `201` — выражение принято для вычисления.
- Код ответа: `422` — невалидные данные.
- Код ответа: `500` — внутренняя ошибка сервера.

**Тело ответа:**
```json
{
    "id": "<уникальный идентификатор выражения>"
}
```

### 2. Получение списка выражений
**Endpoint:** `GET /api/v1/expressions`

**Ответ:**
- Код ответа: `200` — успешно получен список выражений.
- Код ответа: `500` — внутренняя ошибка сервера.

**Тело ответа:**
```json
{
    "expressions": [
        {
            "id": "<идентификатор выражения>",
            "status": "<статус вычисления выражения>",
            "result": "<результат выражения>"
        },
        {
            "id": "<идентификатор выражения>",
            "status": "<статус вычисления выражения>",
            "result": "<результат выражения>"
        }
    ]
}
```

### 3. Получение выражения по его идентификатору
**Endpoint:** `GET /api/v1/expressions/<id>`

**Ответ:**
- Код ответа: `200` — успешно получено выражение.
- Код ответа: `404` — выражение не найдено.
- Код ответа: `500` — внутренняя ошибка сервера.

**Тело ответа:**
```json
{
    "expression": {
        "id": "<идентификатор выражения>",
        "status": "<статус вычисления выражения>",
        "result": "<результат выражения>"
    }
}
```

### 4. Получение задачи для выполнения
**Endpoint:** `GET /internal/task`

**Ответ:**
- Код ответа: `200` — успешно получена задача.
- Код ответа: `404` — нет доступных задач.
- Код ответа: `500` — внутренняя ошибка сервера.

**Тело ответа:**
```json
{
    "task": {
        "id": "<идентификатор задачи>",
        "arg1": "<имя первого аргумента>",
        "arg2": "<имя второго аргумента>",
        "operation": "<операция>",
        "operation_time": "<время выполнения операции>"
    }
}
```

### 5. Прием результата обработки данных
**Endpoint:** `POST /internal/task`

**Запрос:**
```json
{
  "id": "<идентификатор задачи>",
  "result": "<результат вычисления>"
}
```

**Ответ:**
- Код ответа: `200` — успешно записан результат.
- Код ответа: `404` — задача не найдена.
- Код ответа: `422` — невалидные данные.
- Код ответа: `500` — внутренняя ошибка сервера.

---

## Настройка переменных окружения

Для настройки системы используются следующие переменные окружения (задаются в файле `.env`):

- `TIME_ADDITION_MS` — время выполнения операции сложения в миллисекундах.
- `TIME_SUBTRACTION_MS` — время выполнения операции вычитания в миллисекундах.
- `TIME_MULTIPLICATIONS_MS` — время выполнения операции умножения в миллисекундах.
- `TIME_DIVISIONS_MS` — время выполнения операции деления в миллисекундах.
- `AGENT_SLEEP_TIME` — задержка агента перед запросом к Оркестратору.
- `PORT` — порт, на котором будет запущен Оркестратор.
- `COMPUTING_POWER` — количество горутин, используемых Агентом для вычислений.

---

## Запуск проекта

1. Убедитесь, что у вас установлен Golang.
2. Склонируйте репозиторий:
   ```bash
   git clone github.com/klimenkokayot/calc-net-go
   ```
3. Перейдите в директорию проекта:
   ```bash
   cd calc-net-go
   ```
4. Создайте файл `.env` и задайте необходимые переменные окружения.
5. Запустите Оркестратор:
   ```bash
   go run ./cmd/orchestrator/.
   ```
6. Запустите Агент:
   ```bash
   go run ./cmd/agent/.
   ```

---

## Пример использования

1. Отправьте выражение на вычисление:
   ```bash
   curl --location 'http://127.0.0.1:8080/api/v1/calculate' \
   --header 'Content-Type: application/json' \
   --data '{
     "expression": "(2 / 2) + (2 * 2)"
   }'
   ```
2. Получите список выражений:
   ```bash
   curl --location 'http://127.0.0.1:8080/api/v1/expressions'
   ```
3. Получите результат вычисления по идентификатору:
   ```bash
   curl --location 'http://127.0.0.1:8080/api/v1/expressions/<id>'
   ```

---

## Лицензия

Этот проект распространяется под лицензией MIT. Подробности см. в файле [LICENSE](LICENSE).
